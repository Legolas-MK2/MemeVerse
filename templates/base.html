<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}Social Feed{% endblock %}</title>
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
        {% block head %}{% endblock %}
    </head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    {% include 'navbar.html' %}

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    {% block scripts %}
    <script type="module" src="{{ url_for('static', filename='js/videoManager.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/feedManager.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/main.js') }}"></script>
    {% endblock %}
    <script>
        // Apply saved navbar positioning on page load (fallback)
        document.addEventListener('DOMContentLoaded', function() {
            const savedPositions = localStorage.getItem('navbarPositions');
            if (savedPositions) {
                try {
                    const positions = JSON.parse(savedPositions);
                    const navbar = document.getElementById('main-navbar');
                    
                    // Remove all positioning classes
                    navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                    
                    // Apply positioning based on device type
                    const isMobile = window.matchMedia("(max-width: 768px)").matches;
                    if (isMobile) {
                        // For mobile, use mobile setting
                        navbar.classList.add(`nav-${positions.mobile}`);
                    } else {
                        // For desktop, use PC setting
                        navbar.classList.add(`nav-${positions.pc}`);
                    }
                } catch (e) {
                    console.error('Error applying saved positions:', e);
                }
            } else {
                // Apply default positioning based on database defaults
                const navbar = document.getElementById('main-navbar');
                navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                
                // Check if we're on a mobile device
                const isMobile = window.matchMedia("(max-width: 768px)").matches;
                if (isMobile) {
                    // For mobile, use default mobile setting
                    navbar.classList.add('nav-bottom');
                } else {
                    // For desktop, use default PC setting
                    navbar.classList.add('nav-left');
                }
            }
            
            // Initialize Feather icons
            feather.replace();
        });
        
        // Listen for navbar position updates from other tabs
        window.addEventListener('storage', function(e) {
            if (e.key === 'navbarPositionUpdate') {
                // A navbar position update was made in another tab
                const savedPositions = localStorage.getItem('navbarPositions');
                if (savedPositions) {
                    try {
                        const positions = JSON.parse(savedPositions);
                        const navbar = document.getElementById('main-navbar');
                        
                        // Remove all positioning classes
                        navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                        
                        // Apply positioning based on device type
                        const isMobile = window.matchMedia("(max-width: 768px)").matches;
                        if (isMobile) {
                            // For mobile, use mobile setting
                            navbar.classList.add(`nav-${positions.mobile}`);
                        } else {
                            // For desktop, use PC setting
                            navbar.classList.add(`nav-${positions.pc}`);
                        }
                    } catch (e) {
                        console.error('Error applying saved positions:', e);
                    }
                } else {
                    // Apply default positioning based on database defaults
                    const navbar = document.getElementById('main-navbar');
                    navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                    
                    // Check if we're on a mobile device
                    const isMobile = window.matchMedia("(max-width: 768px)").matches;
                    if (isMobile) {
                        // For mobile, use default mobile setting
                        navbar.classList.add('nav-bottom');
                    } else {
                        // For desktop, use default PC setting
                        navbar.classList.add('nav-left');
                    }
                }
            }
        });
        
        // Handle window resize to reapply positioning for mobile
        window.addEventListener('resize', function() {
            const savedPositions = localStorage.getItem('navbarPositions');
            if (savedPositions) {
                try {
                    const positions = JSON.parse(savedPositions);
                    const navbar = document.getElementById('main-navbar');
                    
                    // Remove all positioning classes
                    navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                    
                    // Apply positioning based on device type
                    const isMobile = window.matchMedia("(max-width: 768px)").matches;
                    if (isMobile) {
                        // For mobile, use mobile setting
                        navbar.classList.add(`nav-${positions.mobile}`);
                    } else {
                        // For desktop, use PC setting
                        navbar.classList.add(`nav-${positions.pc}`);
                    }
                } catch (e) {
                    console.error('Error applying saved positions on resize:', e);
                }
            } else {
                // Apply default positioning based on database defaults
                const navbar = document.getElementById('main-navbar');
                navbar.classList.remove('nav-left', 'nav-right', 'nav-top', 'nav-bottom');
                
                // Check if we're on a mobile device
                const isMobile = window.matchMedia("(max-width: 768px)").matches;
                if (isMobile) {
                    // For mobile, use default mobile setting
                    navbar.classList.add('nav-bottom');
                } else {
                    // For desktop, use default PC setting
                    navbar.classList.add('nav-left');
                }
            }
        });
    </script>
</body>
